# Тест-кейсы: Кнопка определения местоположения и маркер

## Обзор функциональности

### Основные требования:
1. Кнопка "Моё местоположение" должна быть видна всегда, независимо от статуса разрешения на геолокацию
2. При первой загрузке маршрута автоматически запрашивается разрешение на геолокацию
3. При первом получении местоположения карта автоматически центрируется
4. При нажатии на кнопку карта центрируется на текущем местоположении пользователя
5. Маркер местоположения отображается как белый круг с красным кругом внутри
6. При ручном перемещении карты автоматическое центрирование не происходит

---

## Тест-кейсы

### TC-LB-001: Автоматический запрос разрешения при первой загрузке маршрута

**Предусловия:**
- Приложение установлено и запущено
- Пользователь авторизован
- Пользователь находится на экране выбора маршрута

**Шаги:**
1. Пользователь выбирает маршрут и переходит на экран карты
2. Наблюдать за поведением приложения

**Ожидаемый результат:**
- При первой загрузке маршрута автоматически появляется диалог запроса разрешения на геолокацию
- Диалог содержит варианты: "While using the app", "Only this time", "Don't allow"
- Кнопка "Моё местоположение" видна в правом нижнем углу карты независимо от выбора пользователя

**Приоритет:** Высокий

---

### TC-LB-002: Отображение кнопки при отсутствии разрешения

**Предусловия:**
- Пользователь находится на экране карты
- Разрешение на геолокацию не выдано

**Шаги:**
1. Проверить наличие кнопки "Моё местоположение" на экране

**Ожидаемый результат:**
- Кнопка "Моё местоположение" отображается в правом нижнем углу карты
- Кнопка имеет иконку местоположения
- Кнопка доступна для нажатия

**Приоритет:** Высокий

---

### TC-LB-003: Поведение при выборе "While using the app"

**Предусловия:**
- Пользователь находится на экране карты
- Появился диалог запроса разрешения на геолокацию

**Шаги:**
1. Пользователь выбирает "While using the app" в диалоге разрешения
2. Дождаться определения местоположения
3. Наблюдать за поведением карты
4. Переместить карту вручную
5. Нажать на кнопку "Моё местоположение"

**Ожидаемый результат:**
- Разрешение выдано успешно
- Местоположение определяется автоматически
- При первом получении местоположения карта автоматически центрируется на местоположении пользователя
- Маркер местоположения отображается как белый круг с красным кругом внутри
- При ручном перемещении карты автоматическое центрирование не происходит
- При нажатии на кнопку карта центрируется на текущем местоположении пользователя

**Приоритет:** Высокий

---

### TC-LB-004: Поведение при выборе "Only this time"

**Предусловия:**
- Пользователь находится на экране карты
- Появился диалог запроса разрешения на геолокацию

**Шаги:**
1. Пользователь выбирает "Only this time" в диалоге разрешения
2. Дождаться определения местоположения
3. Наблюдать за поведением карты
4. Закрыть приложение
5. Запустить приложение снова
6. Перейти на экран карты

**Ожидаемый результат:**
- Разрешение выдано успешно
- Местоположение определяется автоматически
- При первом получении местоположения карта автоматически центрируется
- Маркер местоположения отображается корректно
- При повторном запуске приложения снова появляется диалог запроса разрешения на геолокацию
- Кнопка "Моё местоположение" остается видимой

**Приоритет:** Высокий

---

### TC-LB-005: Поведение при выборе "Don't allow"

**Предусловия:**
- Пользователь находится на экране карты
- Появился диалог запроса разрешения на геолокацию

**Шаги:**
1. Пользователь выбирает "Don't allow" в диалоге разрешения
2. Проверить наличие кнопки "Моё местоположение"
3. Нажать на кнопку "Моё местоположение"
4. Наблюдать за поведением

**Ожидаемый результат:**
- Разрешение отклонено
- Кнопка "Моё местоположение" остается видимой
- При нажатии на кнопку снова появляется диалог запроса разрешения на геолокацию
- Местоположение не определяется

**Приоритет:** Высокий

---

### TC-LB-006: Автоматическое центрирование при первом получении местоположения

**Предусловия:**
- Пользователь находится на экране карты
- Разрешение на геолокацию выдано ("While using the app")
- Местоположение еще не определено

**Шаги:**
1. Дождаться определения местоположения
2. Наблюдать за поведением карты

**Ожидаемый результат:**
- При первом получении местоположения карта автоматически центрируется на местоположении пользователя
- Анимация центрирования плавная
- Масштаб карты устанавливается на уровень 15
- Маркер местоположения отображается в центре экрана

**Приоритет:** Высокий

---

### TC-LB-007: Центрирование по нажатию кнопки после ручного перемещения карты

**Предусловия:**
- Пользователь находится на экране карты
- Разрешение на геолокацию выдано
- Местоположение определено
- Карта была автоматически отцентрирована при первом получении местоположения

**Шаги:**
1. Переместить карту вручную (свайп в любом направлении)
2. Проверить, что карта осталась в выбранной позиции
3. Нажать на кнопку "Моё местоположение"
4. Наблюдать за поведением карты

**Ожидаемый результат:**
- После ручного перемещения карта остается в выбранной позиции (не центрируется автоматически)
- При нажатии на кнопку карта плавно центрируется на текущем местоположении пользователя
- Анимация центрирования плавная
- Масштаб карты устанавливается на уровень 15

**Приоритет:** Высокий

---

### TC-LB-008: Отображение маркера местоположения

**Предусловия:**
- Пользователь находится на экране карты
- Разрешение на геолокацию выдано
- Местоположение определено

**Шаги:**
1. Найти маркер местоположения на карте
2. Проверить внешний вид маркера

**Ожидаемый результат:**
- Маркер отображается на карте в месте текущего местоположения пользователя
- Маркер имеет вид белого круга с красным кругом внутри
- Белый круг имеет серую обводку для видимости на светлом фоне
- Красный круг находится внутри белого круга
- Размер маркера достаточен для хорошей видимости (48dp)
- Маркер масштабирован для лучшей видимости на карте

**Приоритет:** Высокий

---

### TC-LB-009: Поведение при повторном нажатии на кнопку

**Предусловия:**
- Пользователь находится на экране карты
- Разрешение на геолокацию выдано
- Местоположение определено
- Карта уже отцентрирована на местоположении

**Шаги:**
1. Нажать на кнопку "Моё местоположение"
2. Дождаться завершения анимации
3. Нажать на кнопку еще раз
4. Наблюдать за поведением

**Ожидаемый результат:**
- При каждом нажатии на кнопку карта центрируется на текущем местоположении
- Анимация центрирования плавная
- Поведение стабильное при множественных нажатиях

**Приоритет:** Средний

---

### TC-LB-010: Поведение при изменении местоположения пользователя

**Предусловия:**
- Пользователь находится на экране карты
- Разрешение на геолокацию выдано
- Местоположение определено
- Карта отцентрирована на местоположении

**Шаги:**
1. Физически переместиться в другое место (если возможно)
2. Или использовать эмулятор для изменения местоположения
3. Наблюдать за поведением карты и маркера

**Ожидаемый результат:**
- Маркер местоположения обновляется и перемещается на новое местоположение
- Карта НЕ центрируется автоматически при обновлении местоположения (если пользователь не нажимал кнопку)
- Если пользователь нажал кнопку, карта центрируется на новом местоположении

**Приоритет:** Средний

---

### TC-LB-011: Поведение при отсутствии GPS сигнала

**Предусловия:**
- Пользователь находится на экране карты
- Разрешение на геолокацию выдано
- GPS сигнал недоступен (например, в помещении без окон)

**Шаги:**
1. Нажать на кнопку "Моё местоположение"
2. Наблюдать за поведением

**Ожидаемый результат:**
- Кнопка остается видимой и доступной
- При нажатии на кнопку система пытается определить местоположение
- Если местоположение недоступно, карта не центрируется
- Приложение не падает и продолжает работать стабильно

**Приоритет:** Средний

---

### TC-LB-012: Поведение при переключении между маршрутами

**Предусловия:**
- Пользователь находится на экране карты с одним маршрутом
- Разрешение на геолокацию выдано
- Местоположение определено

**Шаги:**
1. Вернуться на экран выбора маршрутов
2. Выбрать другой маршрут
3. Перейти на экран карты нового маршрута
4. Наблюдать за поведением кнопки и маркера

**Ожидаемый результат:**
- Кнопка "Моё местоположение" остается видимой
- Маркер местоположения отображается на карте нового маршрута
- Разрешение на геолокацию сохраняется (не запрашивается повторно)
- Местоположение продолжает определяться

**Приоритет:** Средний

---

### TC-LB-013: Поведение при повороте экрана

**Предусловия:**
- Пользователь находится на экране карты
- Разрешение на геолокацию выдано
- Местоположение определено
- Карта отцентрирована на местоположении

**Шаги:**
1. Повернуть устройство (изменить ориентацию экрана)
2. Наблюдать за поведением кнопки и маркера

**Ожидаемый результат:**
- Кнопка "Моё местоположение" остается видимой в правом нижнем углу
- Маркер местоположения продолжает отображаться корректно
- Карта сохраняет свое состояние (центрирование, масштаб)
- Приложение не падает

**Приоритет:** Низкий

---

### TC-LB-014: Логирование и отладка

**Предусловия:**
- Приложение запущено
- Включено логирование (Logcat)

**Шаги:**
1. Выполнить различные действия с кнопкой и разрешениями
2. Проверить логи в Logcat

**Ожидаемый результат:**
- В логах присутствуют записи с тегами "MapScreen" и "MapViewModel"
- Логи содержат информацию о:
  - Запросе разрешения
  - Результате запроса разрешения
  - Нажатии на кнопку
  - Определении местоположения
  - Центрировании карты
  - Установке маркера
- Логи помогают в отладке проблем

**Приоритет:** Низкий

---

## Критерии приемки

### Функциональные требования:
- ✅ Кнопка "Моё местоположение" всегда видна на карте
- ✅ При первой загрузке маршрута автоматически запрашивается разрешение
- ✅ При первом получении местоположения карта автоматически центрируется
- ✅ При нажатии на кнопку карта центрируется на местоположении
- ✅ Маркер отображается как белый круг с красным кругом внутри
- ✅ При ручном перемещении карты автоматическое центрирование не происходит

### Варианты разрешения:
- ✅ "While using the app" - местоположение определяется при нажатии на кнопку
- ✅ "Only this time" - местоположение определяется, при следующем запуске снова запрашивается разрешение
- ✅ "Don't allow" - кнопка видна, при нажатии открывается диалог запроса разрешения

### Производительность:
- ✅ Анимация центрирования карты плавная
- ✅ Определение местоположения происходит без задержек
- ✅ Приложение не падает при различных сценариях

---

## Известные проблемы и ограничения

1. **Эмулятор:** В эмуляторе Android местоположение может определяться медленнее или требовать ручной установки координат через настройки эмулятора.

2. **GPS сигнал:** В помещении без GPS сигнала определение местоположения может быть неточным или недоступным.

3. **Разрешения Android:** Поведение разрешений может отличаться в зависимости от версии Android и настроек устройства.

---

## Примечания для тестирования

1. Для тестирования в эмуляторе рекомендуется использовать Android Studio с возможностью установки координат через Extended Controls.

2. Для тестирования различных вариантов разрешений можно использовать настройки приложения в системе Android (Settings > Apps > Trust The Route > Permissions).

3. Для проверки логирования рекомендуется использовать Android Studio Logcat с фильтрами по тегам "MapScreen" и "MapViewModel".

4. При тестировании на реальном устройстве рекомендуется проверить поведение в различных условиях (в помещении, на улице, при движении).

---

## История изменений

| Дата | Версия | Изменения | Автор |
|------|--------|-----------|-------|
| 2026-01-21 | 1.0 | Создание первоначального набора тест-кейсов | AI Assistant |
