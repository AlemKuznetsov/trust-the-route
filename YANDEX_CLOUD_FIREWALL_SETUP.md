# Настройка Firewall для бэкенда в Yandex Cloud

## Проблема: "failed to connect to /158.160.180.232 (port 8080)"

Приложение не может подключиться к серверу, потому что порт 8080 заблокирован.

## Решение 1: Настройка Security Groups в Yandex Cloud

### Шаг 1: Откройте консоль Yandex Cloud

1. Войдите в [консоль Yandex Cloud](https://console.cloud.yandex.ru/)
2. Выберите ваш каталог (folder)

### Шаг 2: Найдите вашу виртуальную машину

1. Перейдите в раздел **"Compute Cloud" → "Виртуальные машины"**
2. Найдите вашу VM (`compute-vm-2-4-25-ssd-1769660811014`)
3. Нажмите на неё

### Шаг 3: Настройте Security Groups

1. В карточке VM найдите раздел **"Сетевые интерфейсы"**
2. Нажмите на сетевой интерфейс
3. Перейдите в **"Security Groups"** или **"Группы безопасности"**
4. Нажмите **"Добавить правило"** или **"Create rule"**

### Шаг 4: Создайте правило для порта 8080

**Входящее правило (Ingress):**
- **Тип:** Custom TCP
- **Порт:** 8080
- **Источник:** 0.0.0.0/0 (или конкретный IP/диапазон)
- **Описание:** Backend API

**Сохраните правило**

## Решение 2: Настройка Firewall на сервере

Выполните на сервере:

```bash
# Проверьте статус firewall
sudo ufw status

# Откройте порт 8080
sudo ufw allow 8080/tcp

# Перезагрузите firewall
sudo ufw reload

# Проверьте статус
sudo ufw status
```

## Решение 3: Проверка доступности

### С вашего компьютера (Windows):

```powershell
# Проверка доступности порта
Test-NetConnection -ComputerName 158.160.180.232 -Port 8080

# Или через curl (если установлен)
curl http://158.160.180.232:8080
```

### С сервера:

```bash
# Проверка, что приложение слушает на правильном интерфейсе
sudo ss -tlnp | grep 8080

# Должно показать: 0.0.0.0:8080
```

## Решение 4: Для эмулятора Android

**Проблема:** Эмулятор Android использует виртуальную сеть и может не подключаться к внешним IP.

**Решения:**

### Вариант А: Использовать реальное устройство (рекомендуется)

1. Подключите Android устройство через USB
2. Включите "Отладка по USB"
3. Запустите приложение на реальном устройстве
4. Убедитесь, что устройство подключено к интернету

### Вариант Б: Настроить эмулятор

Если используете эмулятор, попробуйте:

1. **Использовать эмулятор с Google Play** (лучше работает с сетью)
2. **Проверить настройки сети эмулятора:**
   - Settings → Network & Internet → Wi-Fi
   - Убедитесь, что эмулятор подключен к интернету

### Вариант В: Использовать 10.0.2.2 для localhost (если сервер на вашем компьютере)

Если сервер запущен на вашем локальном компьютере:
- В эмуляторе используйте `10.0.2.2` вместо `localhost`
- Но в вашем случае сервер на удаленном IP, поэтому это не поможет

## Проверка после настройки

1. **На сервере:**
   ```bash
   # Проверьте, что приложение запущено
   pgrep -f "gradlew run"
   
   # Проверьте порт
   sudo ss -tlnp | grep 8080
   
   # Проверьте firewall
   sudo ufw status | grep 8080
   ```

2. **С вашего компьютера:**
   ```powershell
   # Проверьте доступность
   curl http://158.160.180.232:8080
   ```

3. **В приложении:**
   - Пересоберите и переустановите приложение
   - Попробуйте зарегистрироваться снова

## Итоговая проверка

После настройки Security Groups и firewall:

1. ✅ Порт 8080 открыт в Security Groups Yandex Cloud
2. ✅ Порт 8080 открыт в firewall на сервере (ufw)
3. ✅ Приложение запущено и слушает на 0.0.0.0:8080
4. ✅ Порт доступен извне (проверено curl с вашего компьютера)

Если все проверки пройдены, но приложение все еще не подключается:
- Используйте реальное Android устройство вместо эмулятора
- Или настройте VPN/туннель для эмулятора
