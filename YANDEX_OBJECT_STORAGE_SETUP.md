# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Yandex Object Storage –¥–ª—è –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤

–î–∞–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ Yandex Object Storage –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

---

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–°–æ–∑–¥–∞–Ω–∏–µ bucket –≤ Yandex Object Storage](#1-—Å–æ–∑–¥–∞–Ω–∏–µ-bucket-–≤-yandex-object-storage)
2. [–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ –≤ –æ–±–ª–∞–∫–æ](#2-–∑–∞–≥—Ä—É–∑–∫–∞-—Ñ–∞–π–ª–æ–≤-–≤-–æ–±–ª–∞–∫–æ)
3. [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—É–±–ª–∏—á–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞](#3-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-–ø—É–±–ª–∏—á–Ω–æ–≥–æ-–¥–æ—Å—Ç—É–ø–∞)
4. [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏](#4-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è-–≤-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏)
5. [–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–¥–µ](#5-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ-–≤-–∫–æ–¥–µ)

---

## 1. –°–æ–∑–¥–∞–Ω–∏–µ bucket –≤ Yandex Object Storage

### –®–∞–≥ 1: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ Yandex Cloud

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ [Yandex Cloud](https://cloud.yandex.ru/)
2. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –∏–ª–∏ –≤–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç
3. –°–æ–∑–¥–∞–π—Ç–µ –æ–±–ª–∞–∫–æ (–µ—Å–ª–∏ –µ—â–µ –Ω–µ —Å–æ–∑–¥–∞–Ω–æ)

### –®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ bucket

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª **Object Storage**
2. –ù–∞–∂–º–∏—Ç–µ **–°–æ–∑–¥–∞—Ç—å bucket**
3. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
   - **–ò–º—è bucket:** `trust-the-route-media` (–∏–ª–∏ –¥—Ä—É–≥–æ–µ —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è)
   - **–¢–∏–ø –¥–æ—Å—Ç—É–ø–∞:** –ü—É–±–ª–∏—á–Ω—ã–π (–¥–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤) –∏–ª–∏ –ü—Ä–∏–≤–∞—Ç–Ω—ã–π (—Å –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–º–∏ URL)
   - **–ö–ª–∞—Å—Å —Ö—Ä–∞–Ω–∏–ª–∏—â–∞:** Standard (–¥–ª—è —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö —Ñ–∞–π–ª–æ–≤)
   - **–†–µ–≥–∏–æ–Ω:** –í—ã–±–µ—Ä–∏—Ç–µ –±–ª–∏–∂–∞–π—à–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, `ru-central1`)

4. –ù–∞–∂–º–∏—Ç–µ **–°–æ–∑–¥–∞—Ç—å**

### –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø–∞–ø–æ–∫

–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:
```
trust-the-route-media/
‚îú‚îÄ‚îÄ images/
‚îÇ   ‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ bus_b/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ attraction_1_image_1.jpg
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ attraction_1_image_2.jpg
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ ...
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îî‚îÄ‚îÄ audio/
    ‚îú‚îÄ‚îÄ routes/
    ‚îÇ   ‚îî‚îÄ‚îÄ bus_b/
    ‚îÇ       ‚îú‚îÄ‚îÄ attraction_1.mp3
    ‚îÇ       ‚îú‚îÄ‚îÄ attraction_2.mp3
    ‚îÇ       ‚îî‚îÄ‚îÄ ...
    ‚îî‚îÄ‚îÄ ...
```

---

## 2. –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ –≤ –æ–±–ª–∞–∫–æ

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–π bucket
2. –°–æ–∑–¥–∞–π—Ç–µ –ø–∞–ø–∫–∏ `images/routes/bus_b/` –∏ `audio/routes/bus_b/`
3. –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª—ã —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ß–µ—Ä–µ–∑ AWS CLI (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤)

Yandex Object Storage —Å–æ–≤–º–µ—Å—Ç–∏–º —Å AWS S3 API.

1. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ AWS CLI:**
   ```bash
   # Windows (—á–µ—Ä–µ–∑ Chocolatey)
   choco install awscli
   
   # –ò–ª–∏ —Å–∫–∞—á–∞–π—Ç–µ —Å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Å–∞–π—Ç–∞ AWS
   ```

2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ credentials:**
   ```bash
   aws configure
   ```
   
   –í–≤–µ–¥–∏—Ç–µ:
   - **AWS Access Key ID:** –í–∞—à Access Key –∏–∑ Yandex Cloud
   - **AWS Secret Access Key:** –í–∞—à Secret Key
   - **Default region:** `ru-central1`
   - **Default output format:** `json`

3. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ endpoint –¥–ª—è Yandex:**
   –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `~/.aws/config`:
   ```ini
   [default]
   region = ru-central1
   s3 =
     endpoint_url = https://storage.yandexcloud.net
   ```

4. **–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª—ã:**
   ```bash
   # –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
   aws s3 sync app/src/main/assets/images/ s3://trust-the-route-media/images/routes/bus_b/ --endpoint-url=https://storage.yandexcloud.net
   
   # –ó–∞–≥—Ä—É–∑–∫–∞ –∞—É–¥–∏–æ
   aws s3 sync app/src/main/assets/audio/ s3://trust-the-route-media/audio/routes/bus_b/ --endpoint-url=https://storage.yandexcloud.net
   ```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ß–µ—Ä–µ–∑ Python —Å–∫—Ä–∏–ø—Ç

–°–æ–∑–¥–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç `upload_to_yandex_storage.py` (—Å–º. —Ä–∞–∑–¥–µ–ª "–£—Ç–∏–ª–∏—Ç—ã")

---

## 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—É–±–ª–∏—á–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞

### –î–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤:

1. –û—Ç–∫—Ä–æ–π—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ bucket
2. –í–∫–ª—é—á–∏—Ç–µ **–ü—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø**
3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–æ–ª–∏—Ç–∏–∫—É –¥–æ—Å—Ç—É–ø–∞:
   ```json
   {
     "Version": "2012-10-17",
     "Statement": [
       {
         "Effect": "Allow",
         "Principal": "*",
         "Action": "s3:GetObject",
         "Resource": "arn:aws:s3:::trust-the-route-media/*"
       }
     ]
   }
   ```

### –î–ª—è –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ (—Å –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–º–∏ URL):

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–µ—Ä–≤–µ—Ä–Ω—É—é –ª–æ–≥–∏–∫—É –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã—Ö URL —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º –≤—Ä–µ–º–µ–Ω–µ–º –¥–µ–π—Å—Ç–≤–∏—è.

---

## 4. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏

### –®–∞–≥ 1: –î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã

–í `app/src/main/java/com/trusttheroute/app/util/Constants.kt`:

```kotlin
object Constants {
    // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã ...
    
    // Yandex Object Storage
    const val YANDEX_STORAGE_BASE_URL = "https://storage.yandexcloud.net/trust-the-route-media"
    const val YANDEX_STORAGE_IMAGES_PATH = "images/routes"
    const val YANDEX_STORAGE_AUDIO_PATH = "audio/routes"
    
    // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∑–∞–≥—Ä—É–∑–∫–∏: —Å–Ω–∞—á–∞–ª–∞ –æ–±–ª–∞–∫–æ, –ø–æ—Ç–æ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã
    const val USE_CLOUD_STORAGE_FIRST = true
}
```

### –®–∞–≥ 2: –û–±–Ω–æ–≤–∏—Ç—å JSON —Ñ–∞–π–ª—ã –º–∞—Ä—à—Ä—É—Ç–æ–≤

–í —Ñ–∞–π–ª–∞—Ö `bus_b_cw.json` –¥–æ–±–∞–≤—å—Ç–µ URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏ –∞—É–¥–∏–æ:

```json
{
  "attractions": [
    {
      "id": "attraction_1",
      "name": "–ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ—Å—Ç–æ–ø—Ä–∏–º–µ—á–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏",
      "imageUrls": [
        "https://storage.yandexcloud.net/trust-the-route-media/images/routes/bus_b/attraction_1_image_1.jpg",
        "https://storage.yandexcloud.net/trust-the-route-media/images/routes/bus_b/attraction_1_image_2.jpg"
      ],
      "audioUrl": "https://storage.yandexcloud.net/trust-the-route-media/audio/routes/bus_b/attraction_1.mp3",
      "imageFileNames": ["attraction_1_image_1.jpg", "attraction_1_image_2.jpg"],
      "audioFileName": "attraction_1.mp3"
    }
  ]
}
```

---

## 5. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–¥–µ

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∑–∞–≥—Ä—É–∑–∫–∏:

1. **–û–±–ª–∞—á–Ω—ã–µ URL** (`imageUrls`, `audioUrl`) - –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω—ã
2. **–õ–æ–∫–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã** (`localImagePaths`, `localAudioPath`) - –∫–∞–∫ fallback

### –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã:

```kotlin
// –í AttractionCard.kt —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:
val imageUrls = buildList {
    // –°–Ω–∞—á–∞–ª–∞ –¥–æ–±–∞–≤–ª—è–µ–º –æ–±–ª–∞—á–Ω—ã–µ URL
    attraction.imageUrls.forEach { url ->
        if (url.isNotBlank()) add(url)
    }
    // –ó–∞—Ç–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –∫–∞–∫ fallback
    attraction.localImagePaths.forEach { path ->
        add("file:///android_asset/images/$path")
    }
}
```

---

## üí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å

### Yandex Object Storage:

- **–•—Ä–∞–Ω–µ–Ω–∏–µ:** ~1.5‚ÇΩ/GB/–º–µ—Å—è—Ü
- **–ò—Å—Ö–æ–¥—è—â–∏–π —Ç—Ä–∞—Ñ–∏–∫:** ~0.5‚ÇΩ/GB
- **–ó–∞–ø—Ä–æ—Å—ã:** –ü–µ—Ä–≤—ã–µ 10,000 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–µ—Å—è—Ü –±–µ—Å–ø–ª–∞—Ç–Ω–æ

### –ü—Ä–∏–º–µ—Ä —Ä–∞—Å—á–µ—Ç–∞ –¥–ª—è 5 GB –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤:

- –•—Ä–∞–Ω–µ–Ω–∏–µ: 5 GB √ó 1.5‚ÇΩ = **7.5‚ÇΩ/–º–µ—Å—è—Ü**
- –¢—Ä–∞—Ñ–∏–∫ (1000 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π √ó 50 MB): 50 GB √ó 0.5‚ÇΩ = **25‚ÇΩ/–º–µ—Å—è—Ü**
- **–ò—Ç–æ–≥–æ: ~30-50‚ÇΩ/–º–µ—Å—è—Ü**

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

1. **–î–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –¥–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤
2. **–î–ª—è –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–µ URL —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º –≤—Ä–µ–º–µ–Ω–µ–º –¥–µ–π—Å—Ç–≤–∏—è
3. **CORS:** –ù–∞—Å—Ç—Ä–æ–π—Ç–µ CORS –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ —Å –≤–∞—à–µ–≥–æ –¥–æ–º–µ–Ω–∞
4. **Rate limiting:** –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–π

---

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- Yandex Object Storage —Å–æ–≤–º–µ—Å—Ç–∏–º —Å AWS S3 API
- –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª—é–±—ã–µ S3-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å CDN –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏
- –†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –∏ —Ç—Ä–∞—Ñ–∏–∫–∞

---

## üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Yandex Object Storage](https://cloud.yandex.ru/docs/storage/)
- [AWS CLI –¥–ª—è Yandex Cloud](https://cloud.yandex.ru/docs/storage/tools/aws-cli)
- [–ü–æ–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞](https://cloud.yandex.ru/docs/storage/concepts/policy)

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2024
