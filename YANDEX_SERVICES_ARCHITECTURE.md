# Архитектура использования сервисов Yandex Cloud

Объяснение, какие сервисы Yandex Cloud подходят для разных задач в приложении Trust The Route.

---

## 📊 Что для чего используется

### ✅ Yandex Object Storage — для медиафайлов

**Что это:**
- Облачное хранилище файлов (S3-совместимое)
- Аналог Amazon S3 или Google Cloud Storage

**Подходит для:**
- ✅ Хранение изображений достопримечательностей
- ✅ Хранение аудиогидов
- ✅ Любые статические файлы (медиа, документы)

**НЕ подходит для:**
- ❌ Регистрация пользователей
- ❌ Авторизация/вход
- ❌ Хранение данных пользователей (email, пароли, токены)
- ❌ Бизнес-логика приложения

**Почему:**
- Object Storage — это просто хранилище файлов
- Не имеет API для работы с пользователями
- Не может обрабатывать запросы регистрации/авторизации
- Не может хранить структурированные данные (таблицы, JSON)

---

### ❌ Yandex Object Storage — НЕ для регистрации/авторизации

**Что нужно для регистрации и авторизации:**

1. **Бэкенд API** (сервер с базой данных)
   - Обработка запросов регистрации/входа
   - Валидация данных
   - Хранение пользователей в базе данных
   - Генерация токенов (JWT)

2. **База данных**
   - Хранение данных пользователей (email, пароли в хешированном виде)
   - Хранение токенов и сессий

**Варианты реализации:**

#### Вариант 1: Собственный бэкенд (рекомендуется)
```
┌─────────────────┐
│  Android App    │
└────────┬─────────┘
         │ HTTP/HTTPS
         ▼
┌─────────────────┐      ┌──────────────┐
│  Backend API    │◄────►│   Database   │
│  (VPS Server)   │      │  (PostgreSQL)│
└─────────────────┘      └──────────────┘
```

**Технологии:**
- Kotlin + Ktor (рекомендуется для единого стека)
- Node.js + Express
- Python + FastAPI
- Java + Spring Boot

**Где разместить:**
- Yandex Cloud Compute Cloud (VPS)
- Любой другой VPS провайдер

---

#### Вариант 2: Yandex ID OAuth (уже используется в проекте ✅)

**Что это:**
- Сервис для входа через аккаунт Yandex
- Не требует собственного бэкенда для базовой авторизации

**Текущая реализация:**
- ✅ `YandexAuthManager.kt` — уже реализован
- ✅ Вход через Yandex ID работает
- ✅ Получение данных пользователя (email, имя, аватар)

**Ограничения:**
- ❌ Не поддерживает регистрацию с email/паролем
- ❌ Только вход через Yandex аккаунт
- ❌ Для полноценной регистрации нужен бэкенд

**Когда использовать:**
- Как альтернативный способ входа (OAuth)
- Для быстрого старта без бэкенда
- В дополнение к основной регистрации

---

#### Вариант 3: Yandex Cloud IAM (НЕ рекомендуется)

**Что это:**
- Сервис для управления доступом к ресурсам Yandex Cloud
- Предназначен для администраторов облака, не для пользователей приложения

**Почему НЕ подходит:**
- Сложная настройка
- Не предназначен для конечных пользователей
- Требует Service Account
- Избыточно для мобильного приложения

---

## 🏗️ Правильная архитектура

### Полная архитектура приложения:

```
┌─────────────────────────────────────────────────────────┐
│                    Android App                          │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐ │
│  │ Registration │  │   Login      │  │  OAuth       │ │
│  │  (Email/Pass)│  │  (Email/Pass)│  │  (Yandex ID) │ │
│  └──────┬───────┘  └──────┬───────┘  └──────┬───────┘ │
└─────────┼──────────────────┼──────────────────┼───────┘
          │                  │                  │
          │ HTTP/HTTPS       │ HTTP/HTTPS       │ OAuth
          │                  │                  │
          ▼                  ▼                  ▼
┌─────────────────────────────────────────────────────────┐
│              Backend API (VPS Server)                   │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐ │
│  │   Auth API   │  │  Routes API  │  │  Users API   │ │
│  │  /register   │  │  /routes     │  │  /users      │ │
│  │  /login      │  │  /attractions│  │  /profile    │ │
│  └──────┬───────┘  └──────┬───────┘  └──────┬───────┘ │
└─────────┼──────────────────┼──────────────────┼───────┘
          │                  │                  │
          ▼                  ▼                  ▼
┌─────────────────┐  ┌─────────────────┐  ┌──────────────┐
│   Database      │  │ Yandex Object   │  │  Yandex ID   │
│  (PostgreSQL)   │  │    Storage      │  │    OAuth     │
│                 │  │                 │  │              │
│ - Users         │  │ - Images         │  │ - Auth       │
│ - Tokens        │  │ - Audio          │  │ - User Info  │
│ - Routes        │  │ - Media files    │  │              │
└─────────────────┘  └─────────────────┘  └──────────────┘
```

---

## 📋 Что использовать для каждой задачи

### 1. Регистрация пользователя

**Нужно:**
- ✅ **Backend API** (VPS сервер)
- ✅ **База данных** (PostgreSQL, MySQL, или другая)
- ❌ Object Storage — не подходит

**Как работает:**
```
Пользователь → Android App → Backend API → Database
                (email/pass)    (валидация)  (сохранение)
```

**Пример endpoint:**
```kotlin
POST /api/v1/auth/register
{
  "email": "user@example.com",
  "password": "securePassword123",
  "name": "User Name"
}
```

---

### 2. Альтернативный вход (OAuth)

**Варианты:**

#### A. Yandex ID OAuth (уже реализовано ✅)
- ✅ Не требует бэкенда
- ✅ Быстрый вход через Yandex аккаунт
- ✅ Уже работает в приложении

#### B. Другие OAuth провайдеры
- Google Sign-In
- Apple Sign-In
- VK ID

**Для OAuth обычно НЕ нужен бэкенд**, но может понадобиться для:
- Связывания OAuth аккаунта с пользователем в вашей БД
- Хранения дополнительных данных пользователя

---

### 3. Хранение медиа и аудио данных

**Нужно:**
- ✅ **Yandex Object Storage** — идеально подходит
- ❌ База данных — не подходит (слишком большие файлы)
- ❌ Backend API — не нужен для статических файлов

**Как работает:**
```
Android App → Yandex Object Storage
              (прямая загрузка/скачивание)
```

**Преимущества:**
- Быстрая загрузка через CDN
- Масштабируемость
- Низкая стоимость
- Не нагружает бэкенд

---

## 🎯 Рекомендуемая архитектура для вашего проекта

### Текущее состояние:

```
✅ Yandex ID OAuth - работает (альтернативный вход)
✅ Yandex Object Storage - готов к использованию (медиафайлы)
❌ Backend API - нужно создать (для регистрации email/pass)
```

### Что нужно добавить:

#### 1. Backend API для регистрации/входа

**Варианты:**

**A. Yandex Cloud Compute Cloud (VPS)**
- Разместить бэкенд на Yandex Cloud
- Использовать Yandex Cloud Database (PostgreSQL)
- Все в одной экосистеме

**B. Другой VPS провайдер**
- Любой VPS (DigitalOcean, AWS, Hetzner и т.д.)
- Подключить к Yandex Object Storage для медиафайлов

**C. Serverless (Yandex Cloud Functions)**
- Для простых API endpoints
- Может быть дешевле для небольших нагрузок

#### 2. База данных

**Варианты:**

**A. Yandex Cloud Database (PostgreSQL)**
- Управляемая база данных
- Автоматические бэкапы
- Интеграция с Yandex Cloud

**B. Собственная PostgreSQL на VPS**
- Больше контроля
- Дешевле для больших объемов

---

## 💡 Итоговые рекомендации

### Для регистрации пользователя:

```
❌ Yandex Object Storage - НЕ подходит
✅ Backend API (VPS) + Database - НУЖНО создать
✅ Yandex ID OAuth - уже есть (альтернативный вход)
```

### Для альтернативного входа:

```
✅ Yandex ID OAuth - уже реализовано и работает
✅ Можно добавить другие провайдеры (Google, Apple)
```

### Для медиа и аудио данных:

```
✅ Yandex Object Storage - ОТЛИЧНО подходит
✅ Уже готово к использованию
✅ Не требует бэкенда для статических файлов
```

---

## 🚀 План действий

### Этап 1: Медиафайлы (можно сделать сейчас)
- ✅ Настроить Yandex Object Storage
- ✅ Загрузить файлы
- ✅ Обновить JSON с URL

### Этап 2: Регистрация/авторизация (нужно создать бэкенд)
- ⚠️ Создать Backend API (VPS + Database)
- ⚠️ Реализовать endpoints `/auth/register`, `/auth/login`
- ⚠️ Настроить JWT токены
- ✅ Yandex ID OAuth уже работает как альтернатива

### Этап 3: Интеграция
- Подключить Backend API к приложению
- Обновить `BASE_URL` в `NetworkModule.kt`
- Протестировать регистрацию и вход

---

## 📊 Сравнение сервисов Yandex Cloud

| Сервис | Для чего | Подходит для регистрации? | Подходит для медиа? |
|--------|----------|---------------------------|---------------------|
| **Object Storage** | Хранение файлов | ❌ Нет | ✅ Да |
| **Compute Cloud** | VPS серверы | ✅ Да (для бэкенда) | ❌ Нет |
| **Database** | База данных | ✅ Да (для хранения пользователей) | ❌ Нет |
| **IAM** | Управление доступом | ❌ Нет (для админов облака) | ❌ Нет |
| **Yandex ID OAuth** | Вход через Yandex | ⚠️ Частично (только OAuth) | ❌ Нет |

---

## ✅ Вывод

**Yandex Object Storage:**
- ✅ **ОТЛИЧНО** подходит для медиа и аудио данных
- ❌ **НЕ подходит** для регистрации пользователей
- ❌ **НЕ подходит** для авторизации

**Для регистрации/авторизации нужно:**
- ✅ Backend API (можно на Yandex Cloud Compute Cloud)
- ✅ База данных (можно Yandex Cloud Database)
- ✅ Yandex ID OAuth уже работает как альтернативный вход

**Рекомендация:**
1. Используйте **Yandex Object Storage** для медиафайлов (готово к использованию)
2. Создайте **Backend API** для регистрации/входа (нужно сделать)
3. **Yandex ID OAuth** уже работает как альтернативный вход ✅

---

**Последнее обновление:** 2024
