<!DOCTYPE html>
<html>
<head>
    <title>Polyline Generator</title>
    <meta charset="UTF-8">
</head>
<body>
    <h1>Polyline Generator для маршрута Автобус Б</h1>
    <div id="result"></div>
    
    <script>
        function encodeValue(value) {
            value = value < 0 ? ~(value << 1) : value << 1;
            let encoded = '';
            while (value >= 0x20) {
                encoded += String.fromCharCode((0x20 | (value & 0x1F)) + 63);
                value >>= 5;
            }
            encoded += String.fromCharCode(value + 63);
            return encoded;
        }

        function encodePolyline(points) {
            if (points.length === 0) return '';
            
            let encoded = '';
            let prevLat = 0;
            let prevLng = 0;
            
            for (let i = 0; i < points.length; i++) {
                const lat = Math.round(points[i][0] * 1e5);
                const lng = Math.round(points[i][1] * 1e5);
                
                const deltaLat = lat - prevLat;
                const deltaLng = lng - prevLng;
                
                encoded += encodeValue(deltaLat);
                encoded += encodeValue(deltaLng);
                
                prevLat = lat;
                prevLng = lng;
            }
            
            return encoded;
        }

        // Координаты остановок маршрута (40 остановок)
        const coordinates = [
            [55.732433, 37.604147],
            [55.736000, 37.593292],
            [55.737558, 37.588918],
            [55.739299, 37.585948],
            [55.739681, 37.585719],
            [55.742225, 37.584614],
            [55.748863, 37.582905],
            [55.748822, 37.582942],
            [55.756055, 37.584268],
            [55.758010, 37.584645],
            [55.759931, 37.585449],
            [55.762794, 37.587616],
            [55.765386, 37.590267],
            [55.766863, 37.592351],
            [55.771555, 37.602069],
            [55.772510, 37.605435],
            [55.773074, 37.609845],
            [55.773311, 37.613219],
            [55.773462, 37.619195],
            [55.773307, 37.627411],
            [55.772501, 37.633175],
            [55.771737, 37.638331],
            [55.769702, 37.644988],
            [55.768665, 37.648885],
            [55.766275, 37.652770],
            [55.763624, 37.656170],
            [55.760596, 37.657232],
            [55.758076, 37.657364],
            [55.754167, 37.656417],
            [55.751072, 37.655585],
            [55.748760, 37.655348],
            [55.746711, 37.655051],
            [55.741068, 37.652698],
            [55.738799, 37.649651],
            [55.732804, 37.640227],
            [55.731279, 37.637030],
            [55.730499, 37.630525],
            [55.729921, 37.624549],
            [55.730124, 37.619145],
            [55.730332, 37.613166],
            [55.732287, 37.604444]
        ];

        const polyline = encodePolyline(coordinates);
        console.log('Polyline:', polyline);
        console.log('Length:', polyline.length);
        console.log('Points:', coordinates.length);
        
        document.getElementById('result').innerHTML = 
            '<h2>Результат:</h2>' +
            '<p><strong>Polyline:</strong></p>' +
            '<textarea style="width: 100%; height: 100px; font-family: monospace;">' + polyline + '</textarea>' +
            '<p><strong>Длина:</strong> ' + polyline.length + ' символов</p>' +
            '<p><strong>Количество точек:</strong> ' + coordinates.length + '</p>';
    </script>
</body>
</html>
